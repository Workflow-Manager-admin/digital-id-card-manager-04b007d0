# Digital ID Card Manager – Backend API (Flask)

This is a Flask-based REST API for managing users and digital ID cards. All authentication is generic (no roles, no RBAC), and the API connects to a PostgreSQL database. Designed to be consumed by a React frontend.

---

## 🚀 Features

- **Generic user registration & login** (no roles, no RBAC)
- **CRUD endpoints for digital ID card "holders"** (profiles of people)
- **CRUD endpoints for individual digital ID cards**
- **Unique number linking**: APIs to link a card’s unique number to a holder profile
- **JWT-based authentication:** All users have equal access (no privilege differentiation)
- **OpenAPI/Swagger docs** available live at `/docs`
- **Full PostgreSQL DB integration** (see `.env.example` and included `schema.sql`)
- **No RBAC, no role fields—truly generic authentication only**

---

## 🛠 Environment Variables

- Backend config is handled via a `.env` file in the `id_backend_api/` directory.
- Copy from `.env.example` and supply the required values.

| Variable           | Purpose                                | Example      |
|--------------------|----------------------------------------|--------------|
| POSTGRES_URL       | Host/address of PostgreSQL DB          | localhost    |
| POSTGRES_USER      | DB username                            | appuser      |
| POSTGRES_PASSWORD  | DB user password                       | dbuser123    |
| POSTGRES_DB        | Database name                          | myapp        |
| POSTGRES_PORT      | Port (default: 5432)                   | 5432         |
| SECRET_KEY         | Secret key for JWT token signing       | changeme     |

See `.env.example` for the required format. All values above are **required**.

> _No environment variables for roles or permissions. The backend uses plain, generic authentication only._

---

## 🗄️ Database Integration

- The backend expects PostgreSQL env variables (see above).
- **Before first run:** Use the included `schema.sql` to set up the database tables for users, holders, and ID cards.
- Make sure a corresponding user + database with correct permissions exist on your PostgreSQL server.

Migrate schema with:
```bash
psql -h $POSTGRES_URL -U $POSTGRES_USER -d $POSTGRES_DB -f schema.sql
```
_Adapt variables as needed._

---

## 🔗 Frontend Integration

- The React app (see separate container) calls this API (usually at `http://localhost:5000`).
- CORS is enabled (accepts calls from frontend).
- **JWT Authentication:** Clients must send header: `Authorization: Bearer <token>`.

---

## 🚦 Development/Deployment Steps

1. **Start/PostgreSQL DB**  
   - Run DB container and initialize (see database README).

2. **Bootstrap backend**  
   - Copy `.env.example` to `.env` and fill in credentials.
   - Run DB migration as above (psql command).
   - Install dependencies:
      ```bash
      pip install -r requirements.txt
      ```
   - Start Flask backend (dev):
      ```bash
      export $(cat .env | xargs)
      python run.py
      ```
      _Or use `flask run` with the right environment._

3. **Set up and run frontend** ([see corresponding frontend README](../id_card_frontend/))
   - Frontend `.env` must point to the running backend:
      ```
      REACT_APP_API_URL=http://localhost:5000
      ```

4. **Integration Flow:**
   - Users sign up/login on the web frontend.
   - React app calls backend endpoints like `/auth`, `/holders`, `/idcards`.
   - Backend processes, stores, and returns requested data.

---

## 📝 API Documentation

- OpenAPI/Swagger: `interfaces/openapi.json`
- Live browser docs: `http://localhost:5000/docs`
- Autogenerated, covers all authentication and CRUD flows

---

## 👩‍💻 Useful Scripts

- `generate_openapi.py` – Export/refresh OpenAPI JSON from Flask.
- Standard Python dependency management (see `requirements.txt`).

---

## 👀 See Also

- Database README (DB env vars, schema)
- Frontend README for environment details
- `schema.sql` for table layout (users, holders, idcards)
- `.env.example` as .env template

---

